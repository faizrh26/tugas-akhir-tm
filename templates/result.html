<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hasil Analisis CV</title>

    <!-- Bootstrap -->
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    >

    <!-- Custom CSS -->
    <link
        rel="stylesheet"
        href="{{ url_for('static', filename='css/style.css') }}"
    >

    <!-- Chart.js untuk radar chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- wordcloud2.js untuk word cloud (CDN yang stabil) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.1.1/wordcloud2.min.js"></script>
</head>
<body>
<div class="container-fluid py-3 main-container">

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light rounded shadow-sm mb-3">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/">CV Role Advisor</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link active" aria-current="page" href="#">Dashboard</a>
                <a class="nav-link" href="#feedback-section">Feedback</a>
                <a class="nav-link" href="/">Upload</a>
            </div>
        </div>
    </nav>

    <!-- GRID ATAS: 3 kolom -->
    <div class="row g-3 top-row">

        <!-- REKOMENDASI ROLE -->
        <div class="col-lg-4">
            <div class="card card-panel h-100">
                <div class="card-body">
                    <h5 class="card-title">Rekomendasi Role Terbaik</h5>
                    {% set pretty_role = best_role.replace('_', ' ').upper() %}
                    <h2 class="display-6 fw-bold role-text mt-2">{{ pretty_role }}</h2>

                    <p class="mt-3 mb-1 fw-semibold">Skor Persentase:</p>
                    <p class="fs-4 mb-2">
                        {{ "%.2f" | format(score.percent[best_role]) }}%
                    </p>

                    <p class="mb-1 fw-semibold">Skor Tiga Role:</p>
                    <ul class="list-unstyled small mb-2">
                        {% for r, pct in score.percent.items() %}
                            <li>
                                <span class="text-muted">{{ r.replace('_', ' ').title() }}</span> :
                                {{ "%.2f" | format(pct) }}%
                            </li>
                        {% endfor %}
                    </ul>

                    <hr class="my-2">

                    <p class="small text-muted mb-0">
                        Catatan: skor ini berbasis isi CV dan rubrik penilaian.
                        Gunakan bersama penilaian manual saat rekrutmen.
                    </p>
                </div>
            </div>
        </div>

        <!-- RADAR CHART (3 ROLE) -->
        <div class="col-lg-4">
            <div class="card card-panel h-100">
                <div class="card-body">
                    <h5 class="card-title mb-2">Spider Chart Kecocokan Role</h5>
                    <p class="small text-muted mb-2">
                        Menunjukkan persentase kecocokan CV terhadap tiga role utama.
                    </p>
                    <div class="chart-wrapper">
                        <canvas id="radarChart"
                                data-role-scores='{{ score.percent | tojson }}'>
                        </canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- PROFIL KANDIDAT -->
        <div class="col-lg-4">
            <div class="card card-panel h-100">
                <div class="card-body profile-card-body">
                    <h5 class="card-title">Profil Kandidat (hasil ekstraksi)</h5>

                    <p class="mb-1"><strong>Nama:</strong> {{ profile.name }}</p>
                    <p class="mb-1"><strong>Pendidikan:</strong> {{ profile.education_level }}</p>

                    <p class="mb-1">
                        <strong>Institusi:</strong>
                        {% if profile.education_institution %}
                            {{ profile.education_institution | join(", ") }}
                        {% else %}
                            <span class="text-muted">Tidak terdeteksi</span>
                        {% endif %}
                    </p>

                    <p class="mb-1">
                        <strong>Major:</strong>
                        {% if profile.education_majors %}
                            {{ profile.education_majors | join(", ") }}
                        {% else %}
                            <span class="text-muted">Tidak terdeteksi</span>
                        {% endif %}
                    </p>

                    <p class="mb-1">
                        <strong>Pengalaman:</strong> {{ profile.experience_years }} tahun
                    </p>

                    <p class="mb-2">
                        <strong>Role Pengalaman:</strong>
                        {% if profile.experience_roles %}
                            {{ profile.experience_roles | join(", ") }}
                        {% else %}
                            <span class="text-muted">Tidak terdeteksi</span>
                        {% endif %}
                    </p>

                    <hr class="my-2">

                    <p class="mb-1"><strong>Skills terdeteksi:</strong></p>
                    <div class="badge-container mb-2">
                        {% for s in profile.skills %}
                            <span class="badge rounded-pill bg-skill me-1 mb-1">{{ s }}</span>
                        {% else %}
                            <span class="text-muted">Tidak ada skill spesifik yang terdeteksi.</span>
                        {% endfor %}
                    </div>

                    <p class="mb-1"><strong>Tools terdeteksi:</strong></p>
                    <div class="badge-container mb-2">
                        {% for t in profile.tools %}
                            <span class="badge rounded-pill bg-tool me-1 mb-1">{{ t }}</span>
                        {% else %}
                            <span class="text-muted">Tidak ada tools spesifik yang terdeteksi.</span>
                        {% endfor %}
                    </div>

                    <p class="mb-1"><strong>Projects terdeteksi:</strong></p>
                    <div class="badge-container mb-2">
                        {% for p in profile.projects %}
                            <span class="badge rounded-pill bg-project me-1 mb-1">{{ p }}</span>
                        {% else %}
                            <span class="text-muted">Tidak ada kata kunci project yang terdeteksi.</span>
                        {% endfor %}
                    </div>

                    <p class="mb-1"><strong>Sertifikasi terdeteksi:</strong></p>
                    <div class="badge-container">
                        {% for c in profile.certifications %}
                            <span class="badge rounded-pill bg-cert me-1 mb-1">{{ c }}</span>
                        {% else %}
                            <span class="text-muted">Tidak ada sertifikasi yang terdeteksi.</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- WORD CLOUD -->
    <div class="row g-3 mt-2 bottom-row">
        <div class="col-12">
            <div class="card card-panel">
                <div class="card-body">
                    <h5 class="card-title mb-2">Word Cloud (Top Keywords TF-IDF)</h5>
                    <p class="small text-muted mb-2">
                        Menunjukkan kata-kata yang paling menonjol di CV berdasarkan TF-IDF.
                    </p>
                    <div id="wordcloud"
                         data-keywords='{{ keywords | tojson }}'
                         class="wordcloud-container">
                    </div>
                </div>
            </div>
        </div>
    </div>

        <!-- FEEDBACK UNTUK USER & HR -->
    <div class="row g-3 mt-3 feedback-row" id="feedback-section">
        <!-- FEEDBACK UNTUK KANDIDAT -->
        <div class="col-md-6">
            <div class="card card-panel h-100">
                <div class="card-body">
                    <h5 class="card-title mb-2">Feedback untuk Kamu (Kandidat)</h5>

                    <p>{{ feedback.for_candidate.summary }}</p>

                    <h6 class="mt-3">Kekuatan utama</h6>
                    <ul class="mb-2">
                        {% for item in feedback.for_candidate.strengths %}
                            <li>{{ item }}</li>
                        {% else %}
                            <li>Tidak ada kekuatan spesifik yang terdeteksi, namun kamu sudah punya pondasi yang bisa dikembangkan.</li>
                        {% endfor %}
                    </ul>

                    <h6 class="mt-3">Hal yang perlu ditingkatkan</h6>
                    <ul class="mb-2">
                        {% for item in feedback.for_candidate.improvements %}
                            <li>{{ item }}</li>
                        {% else %}
                            <li>Belum ada catatan perbaikan spesifik dari sistem.</li>
                        {% endfor %}
                    </ul>

                    <h6 class="mt-3">Saran umum</h6>
                    <p class="small mb-0" style="white-space: pre-line;">
                        {{ feedback.for_candidate.suggestions }}
                    </p>
                </div>
            </div>
        </div>

        <!-- FEEDBACK UNTUK HR / RECRUITER -->
        <div class="col-md-6">
            <div class="card card-panel h-100">
                <div class="card-body">
                    <h5 class="card-title mb-2">Catatan untuk HR / Recruiter</h5>

                    <p>{{ feedback.for_hr.summary }}</p>
                    <p class="mt-2"><strong>Rekomendasi:</strong> {{ feedback.for_hr.recommendation }}</p>

                    <h6 class="mt-3">Risiko / area yang perlu digali</h6>
                    <ul class="mb-2">
                        {% for item in feedback.for_hr.risks %}
                            <li>{{ item }}</li>
                        {% else %}
                            <li>Tidak ada risiko besar yang terdeteksi hanya dari CV.</li>
                        {% endfor %}
                    </ul>

                    <h6 class="mt-3">Contoh pertanyaan interview</h6>
                    <ul class="mb-0">
                        {% for q in feedback.for_hr.questions %}
                            <li>{{ q }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>


</div>

<!-- Custom JS -->
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

</body>
</html>
